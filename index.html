<html>

<head>
  <link href="styles/style.css" rel="stylesheet">
</head>

<body>

<div id="buttons">
  <button onclick="slide1()">1</button>
  <button onclick="slide2()">2</button>
  <button onclick="slide3()">3</button>
  <button id="next" onclick="next()">next</button>
</div>

<div style="text-align:center;" id="description">

</div>

<div style="text-align:center;" id="credits">
  Credits/Citations: <br>
  The dataset used for these visualizations is from <a href="https://www.kaggle.com/datasets/kemical/kickstarter-projects">https://www.kaggle.com/datasets/kemical/kickstarter-projects</a>
  <br>
  Data exploration and cleaning done in Python with the Pandas library in Jupyter Notebook <br>
  Special thanks to d3.js examples from <a href="https://d3-graph-gallery.com/index.html">d3 Graph Gallery</a> , <a href="https://observablehq.com/">Observable HQ</a>, <a href="https://stackoverflow.com/questions/20501067/animating-d3-donut-chart-on-load">Stack Overflow</a>, <a href="https://www.tomordonez.com/d3-bar-chart-title-and-labels/">Tom Ordonez</a>
  <br> <br>
</div>

<div style="text-align:center;" id="filter"></div>
<div style="text-align:center;" id="filterCurrency"></div>

<div style="text-align:center;" id="directions">
</div>

<div style="text-align:center;" id="my_dataviz"></div>
<div style="text-align:center;" id="randomizerTitle"></div>
<div style="text-align:center;" id="randomizer">
  <div id="Product Design"></div>
  <div id="Tabletop Games"></div>
  <div id="Shorts"></div>
  <div id="Music"></div>
  <div id="Documentary"></div>
</div>

<script src='https://d3js.org/d3.v5.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js'></script>
<script>

  function slide1() {

    document.getElementById("next").innerHTML = "next";

    currSlide = 1;

    document.getElementById("description").innerHTML = "Funding a project through crowdfunding is difficult. <br> <br>\n" +
            "        In 2018, <span style=\"color: #d95f02\">53%</span> of Kickstarter Campaigns failed (did not raise enough funding to meet the declared goal). <br>  <br> \n" +
            "        61% of projects raised less than half of their goal. <br> <br>" +
            "Overall, <span style=\"color: red\">64%</span> of projects were unsuccessful (either <span style=\"color: #d95f02\">failed</span>, <span style=\"color: #7570b3\">canceled</span>, or <span style=\"color: #e7298a\">suspended</span>). <br> <br> ";

    document.getElementById("my_dataviz").innerHTML = "";

    document.getElementById('filter').innerHTML = "";
    document.getElementById('filterCurrency').innerHTML = "";
    document.getElementById("directions").innerHTML = "";

    var hoverDirections = document.createElement("div");
    hoverDirections.innerHTML = "Tip: You can hover your mouse over a piece of the donut for the exact count and proportion of the specific category"

    document.getElementById("directions").appendChild(hoverDirections);

    // set the dimensions and margins of the graph
    const width = 1200,
            height = 1200,
            margin = 80;

    // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
    const radius = Math.min(width, height) / 2 - margin

    // append the svg object to the div called 'my_dataviz'
    const svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", `translate(${width/2},${height/2})`);

    svg.append("text")
            .attr("x", 0)
            .attr("y", 0)
            .attr("text-anchor", "middle")
            .style("font-size", "30px")
            .text("Kickstarter Project Conditions");


    // Create dummy data
    const data = {Successful: 136755, Failed: 197719, Canceled:38779, Suspended:1846}

    // var data = [{'state':'Successful', 'count':136755},
    //     {'state':'Failed', 'count':197719},
    //     {'state':'Canceled', 'count':38779},
    //     {'state':'Suspended', 'count':1846}]

    // set the color scale
    const color = d3.scaleOrdinal()
            .domain(["a", "b", "c", "d", "e", "f", "g", "h"])
            .range(d3.schemeDark2);

    // Compute the position of each group on the pie:
    const pie = d3.pie()
            .sort(null) // Do not sort group by size
            .value(d => d[1])
    const data_ready = pie(Object.entries(data))

    // The arc generator
    const arc = d3.arc()
            .innerRadius(radius * 0.5)         // This is the size of the donut hole
            .outerRadius(radius * 0.8)

    // Another arc that won't be drawn. Just for labels positioning
    const outerArc = d3.arc()
            .innerRadius(radius * 0.9)
            .outerRadius(radius * 0.9)

    tooltip = d3
            .select('body')
            .append('div')
            .attr('class', 'd3-tooltip')
            .style('position', 'absolute')
            .style('z-index', '10')
            .style('visibility', 'hidden')
            .style('padding', '10px')
            .style('background', 'rgba(0,0,0,0.6)')
            .style('border-radius', '4px')
            .style('color', '#fff')
            .text('a simple tooltip');

    svg
            .selectAll('allSlices')
            .data(data_ready)
            .join('path')
            .on('mouseover', function (d, i) {
              tooltip
                      .html(
                              `<div>Count: ${d.value}</div><div>Percentage: ${d.value / 375099}</div>`
                      )
                      .style('visibility', 'visible');
            })
            .on('mousemove', function () {
              tooltip
                      .style('top', d3.event.pageY - 10 + 'px')
                      .style('left', d3.event.pageX + 10 + 'px');
            })
            .on('mouseout', function () {
              tooltip.html(``).style('visibility', 'hidden');
            })
            .transition().delay(function(d, i) { return i * 500; }).duration(500)
            .attrTween('d', function(d) {
              var i = d3.interpolate(d.startAngle+0.1, d.endAngle);
              return function(t) {
                d.endAngle = i(t);
                return arc(d);
              }
            })
            .attr('d', arc)
            .attr('fill', d => color(d.data[1]))
            .attr("stroke", "white")
            .style("stroke-width", "2px")
            .style("opacity", 0.7)


    // Build the pie chart: Basically, each part of the pie is a path that we build using the arc function.
    // svg
    //     .selectAll('allSlices')
    //     .data(data_ready)
    //     .join('path')
    //     .attr('d', arc)
    //     .attr('fill', d => color(d.data[1]))
    //     .attr("stroke", "white")
    //     .style("stroke-width", "2px")
    //     .style("opacity", 0.7)
    //     .transition().delay(function(d, i) { return i * 500; }).duration(500)
    //     .attrTween('d', function(d) {
    //         var i = d3.interpolate(d.startAngle+0.1, d.endAngle);
    //         return function(t) {
    //             d.endAngle = i(t);
    //             return arc(d);
    //         }
    //     });

    // Add the polylines between chart and labels:
    svg
            .selectAll('allPolylines')
            .data(data_ready)
            .join('polyline')
            .transition().delay(function(d, i) { return i * 500; }).duration(500)
            .attrTween('d', function(d) {
              var i = d3.interpolate(d.startAngle+0.1, d.endAngle);
              return function(t) {
                d.endAngle = i(t);
                return arc(d);
              }
            })
            .attr("stroke", "black")
            .style("fill", "none")
            .attr("stroke-width", 1)
            .attr('points', function(d) {
              const posA = arc.centroid(d) // line insertion in the slice
              const posB = outerArc.centroid(d) // line break: we use the other arc generator that has been built only for that
              const posC = outerArc.centroid(d); // Label position = almost the same as posB
              const midangle = d.startAngle + (d.endAngle - d.startAngle) / 2 // we need the angle to see if the X position will be at the extreme right or extreme left
              posC[0] = radius * 0.95 * (midangle < Math.PI ? 1 : -1); // multiply by 1 or -1 to put it on the right or on the left
              return [posA, posB, posC]
            })

    // Add the polylines between chart and labels:
    svg
            .selectAll('allLabels')
            .data(data_ready)
            .join('text')
            .transition().delay(function(d, i) { return i * 500; }).duration(500)
            .attrTween('d', function(d) {
              var i = d3.interpolate(d.startAngle+0.1, d.endAngle);
              return function(t) {
                d.endAngle = i(t);
                return arc(d);
              }
            })
            .text(d => d.data[0])
            .attr('transform', function(d) {
              const pos = outerArc.centroid(d);
              const midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
              pos[0] = radius * 0.99 * (midangle < Math.PI ? 1 : -1);
              return `translate(${pos})`;
            })
            .style('text-anchor', function(d) {
              const midangle = d.startAngle + (d.endAngle - d.startAngle) / 2
              return (midangle < Math.PI ? 'start' : 'end')
            })
            .style("font-size", "20px")

  }

  function slide2() {

    document.getElementById("next").innerHTML = "next";

    currSlide = 2;

    var data = [{'category':'Product Design', 'count':7962},
      {'category':'Tabletop Games', 'count':7866},
      {'category':'Shorts', 'count':6673},
      {'category':'Music', 'count':6432},
      {'category':'Documentary', 'count':5924}]

    var data2 = [{'category':'Product Design', 'count':14113},
      {'category':'Documentary', 'count':10157},
      {'category':'Video Games', 'count':9358},
      {'category':'Food', 'count':8157},
      {'category':'Music', 'count':6982}]

    document.getElementById('filter').innerHTML = "";
    document.getElementById('filterCurrency').innerHTML = "";

    document.getElementById("directions").innerHTML = "";

    var hoverDirections = document.createElement("div");
    hoverDirections.innerHTML = "<br> Tip: You can hover your mouse over a bar in the bar chart for the exact count of the specific category"

    document.getElementById("directions").appendChild(hoverDirections);

    successfulBarChart();

    var successfulButton = document.createElement("button");
    successfulButton.innerHTML = "Successful Projects";
    successfulButton.onclick = function() {
      successfulBarChart();
    };

    var failedButton = document.createElement("button");
    failedButton.innerHTML = "Unsuccessful";
    failedButton.onclick = function() {
      failedBarChart();
    };

    var directions = document.createElement("div");
    directions.innerHTML = "You can filter the bar chart by successful or unsuccessful projects using the below buttons: <br> <br>"

    document.getElementById("filter").appendChild(directions);
    document.getElementById("filter").appendChild(successfulButton);
    document.getElementById("filter").appendChild(failedButton);

    function successfulBarChart() {

      document.getElementById("description").innerHTML = "";


      document.getElementById("description").innerHTML = "You may be wondering, which project categories succeed and which end up unsuccessful? <br> <br> The <span style=\"color: #1b9e77\">36%</span> of projects that do succeed tend to be projects in " +
              "\n" +
              "<span style=\"color: #4e79a7\">Product Design</span>, <span style=\"color: #f28e2c\">Tabletop Games</span>, <span style=\"color: #e15759\">Shorts</span>, <span style=\"color: #76b7b2\">Music</span>, <span style=\"color: #59a14f\">Documentary</span> <br> <br>"
      document.getElementById("my_dataviz").innerHTML = "";

      //Successful bar chart

      var margin = {top: 100, right: 100, bottom: 250, left: 100},
              width = 900 - margin.left - margin.right,
              height = 800 - margin.left - margin.right;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svg.append("text")
              .attr("x", width / 2)
              .attr("y", -30)
              .attr("text-anchor", "middle")
              .style("font-size", "30px")
              .text("Category Distribution Of Successful Projects");

      svg.append("text")
              .attr("transform", "translate(" + (width / 2) + " ," + (height + 150) + ")")
              .style("text-anchor", "middle")
              .text("Project Category")
              .style("font-size", "30px");

      svg.append("text")
              .attr("transform", "rotate(-90)")
              .attr("x", -(height / 2))
              .attr("y", -80)
              .style("text-anchor", "middle")
              .text("Project Count")
              .style("font-size", "30px");

      // X axis
      var x = d3.scaleBand()
              .range([0, width])
              .domain(data.map(function (d) {
                return d.category;
              }))
              .padding(0.2);
      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end")
              .style("font-size", "20px");

      // Add Y axis
      var y = d3.scaleLinear()
              .domain([0, 15000])
              .range([height, 0]);
      svg.append("g")
              .call(d3.axisLeft(y))
              .style("font-size", "20px");

      function detColor(category) {
        if (category == 'Product Design') {
          return '#4e79a7'
        } else if (category == 'Tabletop Games') {
          return '#f28e2c'
        } else if (category == 'Shorts') {
          return '#e15759'
        } else if (category == 'Music') {
          return '#76b7b2'
        } else if (category == 'Documentary') {
          return '#59a14f'
        } else if (category == 'Video Games') {
          return '#edc949'
        } else if (category == 'Food') {
          return '#af7aa1'
        }
      }

      tooltip = d3
              .select('body')
              .append('div')
              .attr('class', 'd3-tooltip')
              .style('position', 'absolute')
              .style('z-index', '10')
              .style('visibility', 'hidden')
              .style('padding', '10px')
              .style('background', 'rgba(0,0,0,0.6)')
              .style('border-radius', '4px')
              .style('color', '#fff')
              .text('a simple tooltip');

      // Bars
      svg.selectAll("mybar")
              .data(data)
              .enter()
              .append("rect")
              .attr("x", function (d) {
                return x(d.category);
              })
              .attr("y", function (d) {
                return y(0);
              })
              .attr("width", x.bandwidth())
              .attr("height", function (d) {
                return height - y(0);
              })
              .attr("fill", function (d) {
                return detColor(d.category);
              })
              .on('mouseover', function (d, i) {
                tooltip
                        .html(
                                `<div>Count: ${d.count}</div>`
                        )
                        .style('visibility', 'visible');
              })
              .on('mousemove', function () {
                tooltip
                        .style('top', d3.event.pageY - 10 + 'px')
                        .style('left', d3.event.pageX + 10 + 'px');
              })
              .on('mouseout', function () {
                tooltip.html(``).style('visibility', 'hidden');
              });

      svg.selectAll("rect")
              .transition()
              .duration(1000)
              .attr("y", function (d) {
                return y(d.count);
              })
              .attr("height", function (d) {
                return height - y(d.count);
              })
              .delay(function (d, i) {
                return 100 * i;
              })

      const annotations_success = [
        {
          note: {label: "Product Design is the most successful Kickstarter project category."},
          bgPadding: 20,
          color: ['red'],
          x: 75,
          y: 300,
          dy: -200,
          dx: 500,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        },
        {
          note: {label: "Maybe opt for a new board game idea, which can be just as successful as Product Design projects."},
          bgPadding: 20,
          color: ['red'],
          x: 205,
          y: 350,
          dy: -100,
          dx: 400,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        },
      ];

      const showAnnotationsSuccess = d3.annotation().annotations(annotations_success);
      svg.append('g').call(showAnnotationsSuccess)
    }

    function failedBarChart() {

      document.getElementById("description").innerHTML = "";

      document.getElementById("description").innerHTML = "You may be wondering, which project categories succeed and which end up unsuccessful? <br> <br>" +
              "On the other hand, the <span style=\"color: red\">64%</span> of projects that are unsuccessful (<span style=\"color: #d95f02\">failed</span>, <span style=\"color: #7570b3\">canceled</span>, <span style=\"color: #e7298a\">suspended</span>) tend to be projects in <span style=\"color: #4e79a7\">Product Design</span>, <span style=\"color: #59a14f\">Documentary</span>, <span style=\"color: #edc949\">Video Games</span>, <span style=\"color: #af7aa1\">Food</span>, and <span style=\"color: #76b7b2\">Music</span> <br> <br>"
      document.getElementById("my_dataviz").innerHTML = "";

      //Failed, canceled, suspended bar chart

      var margin = {top: 100, right: 100, bottom: 250, left: 100},
              width = 900 - margin.left - margin.right,
              height = 800 - margin.left - margin.right;

      var margin2 = {top: 100, right: 100, bottom: 250, left: 200},
              width2 = 900 - margin.left - margin.right,
              height2 = 800 - margin.left - margin.right;

      function detColor(category) {
        if (category == 'Product Design') {
          return '#4e79a7'
        } else if (category == 'Tabletop Games') {
          return '#f28e2c'
        } else if (category == 'Shorts') {
          return '#e15759'
        } else if (category == 'Music') {
          return '#76b7b2'
        } else if (category == 'Documentary') {
          return '#59a14f'
        } else if (category == 'Video Games') {
          return '#edc949'
        } else if (category == 'Food') {
          return '#af7aa1'
        }
      }

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
              .append("svg")
              .attr("width", width2 + margin2.left + margin2.right)
              .attr("height", height2 + margin2.top + margin2.bottom)
              .append("g")
              .attr("transform",
                      "translate(" + margin2.left + "," + margin2.top + ")");

      svg.append("text")
              .attr("x", width / 2)
              .attr("y", -30)
              .attr("text-anchor", "middle")
              .style("font-size", "27px")
              .text("Category Distribution Of Unsuccessful Projects");

      svg.append("text")
              .attr("transform", "translate(" + (width / 2) + " ," + (height + 150) + ")")
              .style("text-anchor", "middle")
              .text("Project Category")
              .style("font-size", "30px");

      svg.append("text")
              .attr("transform", "rotate(-90)")
              .attr("x", -(height / 2))
              .attr("y", -80)
              .style("text-anchor", "middle")
              .text("Project Count")
              .style("font-size", "30px");

      // X axis
      var x2 = d3.scaleBand()
              .range([0, width2])
              .domain(data2.map(function (d) {
                return d.category;
              }))
              .padding(0.2);
      svg.append("g")
              .attr("transform", "translate(0," + height2 + ")")
              .call(d3.axisBottom(x2))
              .selectAll("text")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end")
              .style("font-size", "20px");

      // Add Y axis
      var y2 = d3.scaleLinear()
              .domain([0, 15000])
              .range([height2, 0]);
      svg.append("g")
              .call(d3.axisLeft(y2))
              .style("font-size", "20px");

      // Bars
      svg.selectAll("mybar")
              .data(data2)
              .enter()
              .append("rect")
              .attr("x", function (d) {
                return x2(d.category);
              })
              .attr("y", function (d) {
                return y2(0);
              })
              .attr("width", x2.bandwidth())
              .attr("height", function (d) {
                return height2 - y2(0);
              })
              .attr("fill", function (d) {
                return detColor(d.category);
              })
              .on('mouseover', function (d, i) {
                tooltip
                        .html(
                                `<div>Count: ${d.count}</div>`
                        )
                        .style('visibility', 'visible');
              })
              .on('mousemove', function () {
                tooltip
                        .style('top', d3.event.pageY - 10 + 'px')
                        .style('left', d3.event.pageX + 10 + 'px');
              })
              .on('mouseout', function () {
                tooltip.html(``).style('visibility', 'hidden');
              });

      svg.selectAll("rect")
              .transition()
              .duration(1000)
              .attr("y", function (d) {
                return y2(d.count);
              })
              .attr("height", function (d) {
                return height2 - y2(d.count);
              })
              .delay(function (d, i) {
                return 100 * i;
              })

      const annotations = [
        {
          note: {label: "However, this is also the case for unsuccessful projects."},
          bgPadding: 20,
          color: ['red'],
          x: 50,
          y: 30,
          dy: -25,
          dx: -50,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        },
      ];

      const showAnnotations = d3.annotation().annotations(annotations);
      svg.append('g').call(showAnnotations)
    }

  }

  async function slide3() {

    document.getElementById("next").innerHTML = "start over";

    currSlide = 3;

    document.getElementById("description").innerHTML = "What about the most popular currencies used? <br> <br> The distribution of currencies can give an idea of where in the world Kickstarter Campaigns are usually held. <br> <br> You may also want to know how long Kickstarter Campaigns tend to be. <br> <br>";

    document.getElementById("my_dataviz").innerHTML = "";

    document.getElementById("directions").innerHTML = "";

    var hoverDirections = document.createElement("div");
    hoverDirections.innerHTML = "<br> Tip: You can hover your mouse over a bar in the bar chart or bar in the histogram for the exact count of the specific category/bucket"

    document.getElementById("directions").appendChild(hoverDirections);

    // var data = await d3.csv("ks-projects-201801.csv");
    //
    // var product_design = data.filter(function(row) {
    //   return row['category'] == 'Product Design'
    // });
    //
    // var tabletop_games = data.filter(function(row) {
    //   return row['category'] == 'Tabletop Games'
    // });
    //
    // var shorts = data.filter(function(row) {
    //   return row['category'] == 'Shorts'
    // });
    //
    // var music = data.filter(function(row) {
    //   return row['category'] == 'Music'
    // });
    //
    // var documentary = data.filter(function(row) {
    //   return row['category'] == 'Documentary'
    // });
    //
    // function getRandomInt(max) {
    //   return Math.floor(Math.random() * max);
    // }
    //
    // var selected_product_design = product_design[getRandomInt(product_design.length - 1)];
    // var selected_tabletop_games = tabletop_games[getRandomInt(tabletop_games.length - 1)];
    // var selected_shorts = shorts[getRandomInt(shorts.length - 1)];
    // var selected_music = music[getRandomInt(music.length - 1)];
    // var selected_documentary = documentary[getRandomInt(documentary.length - 1)];
    //
    // document.getElementById("description").innerHTML = selected_product_design.name + selected_tabletop_games.name + selected_shorts.name + selected_music.name + selected_documentary.name;
    // console.log(product_design.length)

    var data = [{'currency':'USD', 'count':111120},
      {'currency':'GBP', 'count':12360},
      {'currency':'CAD', 'count':4269},
      {'currency':'EUR', 'count':4211},
      {'currency':'AUD', 'count':2081},
      {'currency':'SEK', 'count':529},
      {'currency':'MXN', 'count':503},
      {'currency':'NZD', 'count':459},
      {'currency':'DKK', 'count':378},
      {'currency':'HKD', 'count':251},
      {'currency':'SGD', 'count':206},
      {'currency':'CHF', 'count':201},
      {'currency':'NOK', 'count':171},
      {'currency':'JPY', 'count':16}]

    var data2 = [{'currency':'USD', 'count':181669},
      {'currency':'GBP', 'count':21336},
      {'currency':'EUR', 'count':13032},
      {'currency':'CAD', 'count':10492},
      {'currency':'AUD', 'count':5766},
      {'currency':'MXN', 'count':1249},
      {'currency':'SEK', 'count':1229},
      {'currency':'NZD', 'count':988},
      {'currency':'DKK', 'count':738},
      {'currency':'CHF', 'count':559},
      {'currency':'NOK', 'count':539},
      {'currency':'HKD', 'count':367},
      {'currency':'SGD', 'count':349},
      {'currency':'JPY', 'count':24}]

    function detColor(currency) {
      if (currency == 'USD') {
        return '#1F77B4FF'
      } else if (currency == 'GBP') {
        return '#FF7F0EFF'
      } else if (currency == 'CAD') {
        return '#2CA02CFF'
      } else if (currency == 'EUR') {
        return '#D62728FF'
      } else if (currency == 'AUD') {
        return '#9467BDFF'
      } else if (currency == 'SEK') {
        return '#8C564BFF'
      } else if (currency == 'MXN') {
        return '#E377C2FF'
      } else if (currency == 'NZD') {
        return '#7F7F7FFF'
      } else if (currency == 'DKK') {
        return '#BCBD22FF'
      } else if (currency == 'HKD') {
        return '#17BECFFF'
      } else if (currency == 'SGD') {
        return '#AEC7E8FF'
      } else if (currency == 'CHF') {
        return '#FFBB78FF'
      } else if (currency == 'NOK') {
        return '#98DF8AFF'
      } else if (currency == 'JPY') {
        return '#FF9896FF'
      }
    }

    document.getElementById('filter').innerHTML = "";
    document.getElementById('filterCurrency').innerHTML = "";

    successfulBarChart();

    var successfulButton = document.createElement("button");
    successfulButton.innerHTML = "Successful Projects";
    successfulButton.onclick = function() {
      successfulBarChart();
    };

    var failedButton = document.createElement("button");
    failedButton.innerHTML = "Unsuccessful Projects";
    failedButton.onclick = function() {
      failedBarChart();
    };

    var directions = document.createElement("div");
    directions.innerHTML = "You can filter the bar chart by successful or unsuccessful projects using the below buttons: <br> <br>"

    document.getElementById("filter").appendChild(directions);
    document.getElementById("filter").appendChild(successfulButton);
    document.getElementById("filter").appendChild(failedButton);

    function successfulBarChart() {
      document.getElementById("my_dataviz").innerHTML = "";

      // set the dimensions and margins of the graph
      var margin = {top: 100, right: 100, bottom: 250, left: 100},
              width = 900 - margin.left - margin.right,
              height = 800 - margin.left - margin.right;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svg.append("text")
              .attr("x", width / 2)
              .attr("y", -30)
              .attr("text-anchor", "middle")
              .style("font-size", "30px")
              .text("Currency Distribution of Successful Projects");

      svg.append("text")
              .attr("transform", "translate(" + (width / 2) + " ," + (height + 100) + ")")
              .style("text-anchor", "middle")
              .text("Currency")
              .style("font-size", "30px");

      svg.append("text")
              .attr("transform", "rotate(-90)")
              .attr("x", -(height / 2))
              .attr("y", -80)
              .style("text-anchor", "middle")
              .text("Currency Count")
              .style("font-size", "30px");

      const annotations_success = [
        {
          note: {label: "USD is the most popular currency for successful Kickstarter Campaigns"},
          bgPadding: 20,
          color: ['red'],
          x: 45,
          y: 330,
          dy: -200,
          dx: 500,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        },
        {
          note: {label: "But currencies outside the US and UK differ in usage amount between Successful and Unsuccessful projects. For successful projects, the Canadian dollar is the third most common currency."},
          bgPadding: 20,
          color: ['red'],
          x: 135,
          y: 580,
          dy: -100,
          dx: 200,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        }
      ];

      const showAnnotationsSuccess = d3.annotation().annotations(annotations_success);
      svg.append('g').call(showAnnotationsSuccess)

      // X axis
      var x = d3.scaleBand()
              .range([0, width])
              .domain(data.map(function (d) {
                return d.currency;
              }))
              .padding(0.2);
      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end")

      // Add Y axis
      var y = d3.scaleLinear()
              .domain([0, 200000])
              .range([height, 0]);
      svg.append("g")
              .call(d3.axisLeft(y));

      tooltip = d3
              .select('body')
              .append('div')
              .attr('class', 'd3-tooltip')
              .style('position', 'absolute')
              .style('z-index', '10')
              .style('visibility', 'hidden')
              .style('padding', '10px')
              .style('background', 'rgba(0,0,0,0.6)')
              .style('border-radius', '4px')
              .style('color', '#fff')
              .text('a simple tooltip');

      // Bars
      svg.selectAll("mybar")
              .data(data)
              .enter()
              .append("rect")
              .attr("x", function (d) {
                return x(d.currency);
              })
              .attr("y", function (d) {
                return y(0);
              })
              .attr("width", x.bandwidth())
              .attr("height", function (d) {
                return height - y(0);
              })
              .attr("fill", function(d) {
                return detColor(d.currency)
              })
              .on('mouseover', function (d, i) {
                tooltip
                        .html(
                                `<div>Count: ${d.count}</div>`
                        )
                        .style('visibility', 'visible');
              })
              .on('mousemove', function () {
                tooltip
                        .style('top', d3.event.pageY - 10 + 'px')
                        .style('left', d3.event.pageX + 10 + 'px');
              })
              .on('mouseout', function () {
                tooltip.html(``).style('visibility', 'hidden');
              });

      svg.selectAll("rect")
              .transition()
              .duration(1000)
              .attr("y", function (d) {
                return y(d.count);
              })
              .attr("height", function (d) {
                return height - y(d.count);
              })
              .delay(function (d, i) {
                return 100 * i;
              })

      histogram()
    }

    function failedBarChart() {
      document.getElementById("my_dataviz").innerHTML = "";

      // set the dimensions and margins of the graph
      var margin = {top: 100, right: 100, bottom: 250, left: 100},
              width = 900 - margin.left - margin.right,
              height = 800 - margin.left - margin.right;

      // append the svg object to the body of the page
      var svg = d3.select("#my_dataviz")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
              .append("g")
              .attr("transform",
                      "translate(" + margin.left + "," + margin.top + ")");

      svg.append("text")
              .attr("x", width / 2)
              .attr("y", -30)
              .attr("text-anchor", "middle")
              .style("font-size", "30px")
              .text("Currency Distribution of Unsuccessful Projects");

      svg.append("text")
              .attr("transform", "translate(" + (width / 2) + " ," + (height + 100) + ")")
              .style("text-anchor", "middle")
              .text("Currency")
              .style("font-size", "30px");

      svg.append("text")
              .attr("transform", "rotate(-90)")
              .attr("x", -(height / 2))
              .attr("y", -80)
              .style("text-anchor", "middle")
              .text("Currency Count")
              .style("font-size", "30px");

      const annotations_success = [
        {
          note: {label: "USD is the most popular currency for Kickstarter Campaigns, but here are other currencies that are also supported."},
          bgPadding: 20,
          color: ['red'],
          x: 45,
          y: 330,
          dy: -200,
          dx: 500,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        },
        {
          note: {label: "But currencies outside the US and UK differ in usage amount between Successful and Unsuccessful projects. For unsuccessful projects, the Euro is the third most popular currency."},
          bgPadding: 20,
          color: ['red'],
          x: 135,
          y: 550,
          dy: -100,
          dx: 200,
          type: d3.annotationCalloutElbow,
          connector: {end: "arrow"},
          subject: {radius: 25, radiusPadding: 10},
        }
      ];

      const showAnnotationsSuccess = d3.annotation().annotations(annotations_success);
      svg.append('g').call(showAnnotationsSuccess)

      // X axis
      var x = d3.scaleBand()
              .range([0, width])
              .domain(data2.map(function (d) {
                return d.currency;
              }))
              .padding(0.2);
      svg.append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(x))
              .selectAll("text")
              .attr("transform", "translate(-10,0)rotate(-45)")
              .style("text-anchor", "end")

      // Add Y axis
      var y = d3.scaleLinear()
              .domain([0, 200000])
              .range([height, 0]);
      svg.append("g")
              .call(d3.axisLeft(y));

      tooltip = d3
              .select('body')
              .append('div')
              .attr('class', 'd3-tooltip')
              .style('position', 'absolute')
              .style('z-index', '10')
              .style('visibility', 'hidden')
              .style('padding', '10px')
              .style('background', 'rgba(0,0,0,0.6)')
              .style('border-radius', '4px')
              .style('color', '#fff')
              .text('a simple tooltip');

      // Bars
      svg.selectAll("mybar")
              .data(data2)
              .enter()
              .append("rect")
              .attr("x", function (d) {
                return x(d.currency);
              })
              .attr("y", function (d) {
                return y(0);
              })
              .attr("width", x.bandwidth())
              .attr("height", function (d) {
                return height - y(0);
              })
              .attr("fill", function(d) {
                return detColor(d.currency)
              })
              .on('mouseover', function (d, i) {
                tooltip
                        .html(
                                `<div>Count: ${d.count}</div>`
                        )
                        .style('visibility', 'visible');
              })
              .on('mousemove', function () {
                tooltip
                        .style('top', d3.event.pageY - 10 + 'px')
                        .style('left', d3.event.pageX + 10 + 'px');
              })
              .on('mouseout', function () {
                tooltip.html(``).style('visibility', 'hidden');
              });

      svg.selectAll("rect")
              .transition()
              .duration(1000)
              .attr("y", function (d) {
                return y(d.count);
              })
              .attr("height", function (d) {
                return height - y(d.count);
              })
              .delay(function (d, i) {
                return 100 * i;
              })

      histogram()
    }

    async function histogram() {

    //histogram

    var margin = {top: 100, right: 100, bottom: 250, left: 100},
            width = 900 - margin.left - margin.right,
            height = 800 - margin.left - margin.right;

    // set the dimensions and margins of the graph
    var margin2 = {top: 100, right: 100, bottom: 250, left: 200},
            width2 = 900 - margin.left - margin.right,
            height2 = 800 - margin.left - margin.right;

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
            .append("svg")
            .attr("width", width + margin2.left + margin2.right)
            .attr("height", height + margin2.top + margin2.bottom)
            .append("g")
            .attr("transform",
                    "translate(" + margin2.left + "," + margin2.top + ")");

    svg.append("text")
            .attr("x", width/2)
            .attr("y", -30)
            .attr("text-anchor", "middle")
            .style("font-size", "30px")
            .text("Length of Campaign Distribution");

    svg.append("text")
            .attr("transform", "translate(" + (width/2) + " ," + (height + 100) + ")")
            .style("text-anchor", "middle")
            .text("Length of Campaign (Days)")
            .style("font-size", "30px");

    svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", -(height/2))
            .attr("y", -80)
            .style("text-anchor", "middle")
            .text("Length of Campaign (Days) Count")
            .style("font-size", "30px");

    // get the data
    var data = await d3.csv("kickstarter_clean.csv");


    // X axis: scale and draw:
    var x = d3.scaleLinear()
            .domain([0,91])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
            .range([0, width]);
    svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            // .transition()
            // .duration(1000)
            .call(d3.axisBottom(x));

    const annotations = [
      {
        note: { label: "Kickstarter Campaigns are usually a month long for both successful and failed projects." },
        bgPadding: 20,
        color: ['red'],
        x: 220,
        y: 175,
        dy: -50,
        dx: 125,
        type: d3.annotationCalloutElbow,
        connector: { end: "arrow" },
        subject: { radius: 25, radiusPadding: 10 },
      },
      {
        note: { label: "There are much less successes and more failures around two months. You may not want to campaign for too long." },
        bgPadding: 20,
        color: ['red'],
        x: 455,
        y: 500,
        dy: -50,
        dx: 125,
        type: d3.annotationCalloutElbow,
        connector: { end: "arrow" },
        subject: { radius: 25, radiusPadding: 10 },
      }
    ];

    const showAnnotations = d3.annotation().annotations(annotations);
    svg.append('g').call(showAnnotations)

    // set the parameters for the histogram
    var histogram = d3.histogram()
            .value(function(d) { return +d.Difference; })   // I need to give the vector of value
            .domain(x.domain())  // then the domain of the graphic
            .thresholds(x.ticks(40)); // then the numbers of bins

    // And apply twice this function to data to get the bins.
    var bins1 = histogram(data.filter( function(d){return d.state === "successful" || d.state === "live"} ));
    var bins2 = histogram(data.filter( function(d){return d.state != "successful" || d.state != "live"} ));

    // Y axis: scale and draw:
    var y = d3.scaleLinear()
            .range([height, 0]);
    y.domain([0, 200000]);   // d3.hist has to be called before the Y axis obviously
    svg.append("g")
            // .transition()
            // .duration(1000)
            .call(d3.axisLeft(y));

    // append the bars for series 1
    var rect = svg.selectAll("rect")
            .data(bins1)
            .enter()
            .append("rect")
            // .transition()
            // .duration(1000)
            .attr("x", 1)
            .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
            .attr("height", function(d) { return height - y(d.length); })
            .style("fill", "#69b3a2")
            .style("opacity", 0.6)

    rect.transition().duration(1000);
    rect.on('mouseover', function (d, i) {
      tooltip
              .html(
                      `<div>Range: ${d.x0 + "-" + d.x1}</div><div>Count: ${d.length}</div>`
              )
              .style('visibility', 'visible');
    })
            .on('mousemove', function () {
              tooltip
                      .style('top', d3.event.pageY - 10 + 'px')
                      .style('left', d3.event.pageX + 10 + 'px');
            })
            .on('mouseout', function () {
              tooltip.html(``).style('visibility', 'hidden');
            });



    // append the bars for series 2
    var rect2 = svg.selectAll("rect2")
            .data(bins2)
            .enter()
            .append("rect")
            // .transition()
            // .duration(1000)
            .attr("x", 1)
            .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
            .attr("height", function(d) { return height - y(d.length); })
            .style("fill", "#404080")
            .style("opacity", 0.3)

    rect2.transition().duration(1000);
    rect2.on('mouseover', function (d, i) {
      tooltip
              .html(
                      `<div>Range: ${d.x0 + "-" + d.x1}</div><div>Count: ${d.length}</div>`
              )
              .style('visibility', 'visible');
    })
            .on('mousemove', function () {
              tooltip
                      .style('top', d3.event.pageY - 10 + 'px')
                      .style('left', d3.event.pageX + 10 + 'px');
            })
            .on('mouseout', function () {
              tooltip.html(``).style('visibility', 'hidden');
            });

    // Handmade legend
    svg.append("circle").attr("cx",550).attr("cy",30).attr("r", 6).style("fill", "#69b3a2")
    svg.append("circle").attr("cx",550).attr("cy",60).attr("r", 6).style("fill", "#404080")
    svg.append("text").attr("x", 570).attr("y", 30).text("Successful").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 570).attr("y", 60).text("Unsuccessful").style("font-size", "15px").attr("alignment-baseline","middle")

}
    // var product_design = data.filter(function(row) {
    //   return row['category'] == 'Product Design' && row['state'] == 'successful'
    // });
    //
    // var tabletop_games = data.filter(function(row) {
    //   return row['category'] == 'Tabletop Games' && row['state'] == 'successful'
    // });
    //
    // var shorts = data.filter(function(row) {
    //   return row['category'] == 'Shorts' && row['state'] == 'successful'
    // });
    //
    // var music = data.filter(function(row) {
    //   return row['category'] == 'Music' && row['state'] == 'successful'
    // });
    //
    // var documentary = data.filter(function(row) {
    //   return row['category'] == 'Documentary' && row['state'] == 'successful'
    // });
    //
    // function getRandomInt(max) {
    //   return Math.floor(Math.random() * max);
    // }
    //
    // function randomProjects() {
    //   var selected_product_design = product_design[getRandomInt(product_design.length - 1)];
    //   var selected_tabletop_games = tabletop_games[getRandomInt(tabletop_games.length - 1)];
    //   var selected_shorts = shorts[getRandomInt(shorts.length - 1)];
    //   var selected_music = music[getRandomInt(music.length - 1)];
    //   var selected_documentary = documentary[getRandomInt(documentary.length - 1)];
    //
    //   document.getElementById("Product Design").innerHTML = 'Product Design: <br>' + selected_product_design.name + '<br>'
    //   document.getElementById("Tabletop Games").innerHTML = 'Tabletop Games: <br>' + selected_tabletop_games.name + '<br>'
    //   document.getElementById("Shorts").innerHTML = 'Shorts: <br>' + selected_shorts.name + '<br>'
    //   document.getElementById("Music").innerHTML = 'Music: <br>' + selected_music.name + '<br>'
    //   document.getElementById("Documentary").innerHTML = 'Documentary: <br>' + selected_documentary.name + '<br>'
    //
    //   var image1 = document.createElement("img");
    //   image1.setAttribute("src", "images/productdesign.jpg");
    //   image1.setAttribute("height", "100");
    //   image1.setAttribute("width", "100");
    //   image1.setAttribute("alt", "product design");
    //
    //   var image2 = document.createElement("img");
    //   image2.setAttribute("src", "images/tabletopgames.jpg");
    //   image2.setAttribute("height", "100");
    //   image2.setAttribute("width", "100");
    //   image2.setAttribute("alt", "tabletop games");
    //
    //   var image3 = document.createElement("img");
    //   image3.setAttribute("src", "images/shorts.jpg");
    //   image3.setAttribute("height", "100");
    //   image3.setAttribute("width", "100");
    //   image3.setAttribute("alt", "shorts");
    //
    //   var image4 = document.createElement("img");
    //   image4.setAttribute("src", "images/music.jpg");
    //   image4.setAttribute("height", "100");
    //   image4.setAttribute("width", "100");
    //   image4.setAttribute("alt", "music");
    //
    //   var image5 = document.createElement("img")
    //   image5.setAttribute("src", "images/documentary.jpg");
    //   image5.setAttribute("height", "100");
    //   image5.setAttribute("width", "100");
    //   image5.setAttribute("alt", "product design");
    //
    //   document.getElementById("Product Design").appendChild(image1)
    //   document.getElementById("Tabletop Games").appendChild(image2)
    //   document.getElementById("Shorts").appendChild(image3)
    //   document.getElementById("Music").appendChild(image4)
    //   document.getElementById("Documentary").appendChild(image5)
    // }
    //
    // randomProjects();
    //
    // document.getElementById("randomizerTitle").innerHTML = 'Random Successful Projects <br> <br>'
    //
    // var randomizerButton = document.createElement("button");
    // randomizerButton.innerHTML = "More Random Projects";
    // randomizerButton.onclick = function() {
    //   randomProjects();
    // };
    //
    // document.getElementById("randomizerTitle").appendChild(randomizerButton);

  }

  function next() {
    if(currSlide == 1) {
      slide2();
    }
    else if(currSlide == 2) {
      slide3();
    }
    else if(currSlide == 3) {
      slide1();
    }
  }

  var currSlide = 1;
  slide1();

</script>
</body>
</html>